name: validate hausKI events

on:
  push:
    paths:
      - "export/**"
      - "data/**"
      - "logs/**"
      - ".github/workflows/validate-events.yml"
  pull_request:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  validate-jsonl:
    # NOTE: hashFiles() cannot use matrix variables at job level.
    # The reusable workflow should handle missing files gracefully.
    name: "events.jsonl schema check (${{ matrix.file }})"
    uses: heimgewebe/metarepo/.github/workflows/reusable-validate-jsonl.yml@contracts-v1
    strategy:
      fail-fast: false
      matrix:
        file:
          - export/events.jsonl
          - data/events.jsonl
          - logs/events.jsonl
    with:
      toolchain: stable
      jsonl_path: ${{ matrix.file }}
      schema_url: https://raw.githubusercontent.com/heimgewebe/metarepo/contracts-v1/contracts/event.line.schema.json
      strict: false
      validate_formats: true
